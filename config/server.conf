
# Configuration serveur pour webserv
# Format inspiré de NGINX

# Premier serveur virtuel : Site statique de documentation
server {
	# Port et interface d'écoute
	listen 127.0.0.1:8080;

	# Nom du serveur (pour le virtual hosting)
	server_name localhost;

	# Taille maximale autorisée pour le corps des requêtes (en octets)
	max_body_size 1000000;

	# Dossier racine par défaut pour ce serveur
	root www/server1;

	# Pages d'erreur personnalisées
	error_page 400 ./errors/400.html;
	error_page 404 ./errors/404.html;
	error_page 405 ./errors/405.html;
	error_page 413 ./errors/413.html;
	error_page 500 ./errors/500.html;
	# Route 1 : La racine du site (/)
	location / {
		# Méthodes HTTP autorisées
		allowed_methods GET;

		# Fichier à servir par défaut pour un dossier
		index index.html;

		# Activer le listing de répertoire
		autoindex on;
	}

	# Route 2 : Ressources statiques
	location /assets {
		allowed_methods GET;
		root www/server1/assets;
		index index.html;
	}
}

# Deuxième serveur virtuel : API avec CGI
server {
	listen 127.0.0.1:8081;
	server_name api.localhost;
	max_body_size 5000000;
	root www/server2;

	error_page 400 ./errors/400.html;
	error_page 404 ./errors/404.html;
	error_page 405 ./errors/405.html;
	error_page 413 ./errors/413.html;
	error_page 500 ./errors/500.html;
	# Route 1 : Exécuter des scripts Python (CGI)
	location /scripts {
		allowed_methods GET POST;
		root www/server2/scripts;

		# Configuration CGI pour Python
		cgi_extension .py /usr/bin/python3;
	}
	# Route 2 : Upload de fichiers
	location /upload {
		allowed_methods POST;
		root www/server2/uploads;
		allow_upload on;
		upload_store www/server2/uploads;
	}

	# Route 3 : Suppression de fichiers
	location /files {
		allowed_methods GET POST DELETE;
		root www/server2/files;
	}
}

# Troisième serveur virtuel : Exemple simple
server {
	listen 127.0.0.1:8082;
	server_name test.localhost;
	max_body_size 100000;
	root www/server3;

	error_page 400 ./errors/400.html;
	error_page 404 ./errors/404.html;
	error_page 405 ./errors/405.html;
	error_page 413 ./errors/413.html;
	error_page 500 ./errors/500.html;

	location / {
		allowed_methods GET;
		index index.html;
		autoindex off;
	}

	# Redirection
	location /old {
		redirect_url http://localhost:8082/new;
	}
}

